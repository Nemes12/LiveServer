warning: in the working copy of 'db.js', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'index.html', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'js/app-initializer.js', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'js/code-editor.js', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'js/main.js', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'js/socket-service.js', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'js/utils.js', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'package.json', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'server.js', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'style.css', LF will be replaced by CRLF the next time Git touches it
[1mdiff --git a/data/code.db b/data/code.db[m
[1mindex 41b8165..ae7651b 100644[m
Binary files a/data/code.db and b/data/code.db differ
[1mdiff --git a/js/app-initializer.js b/js/app-initializer.js[m
[1mindex 19bb1d9..bf38654 100644[m
[1m--- a/js/app-initializer.js[m
[1m+++ b/js/app-initializer.js[m
[36m@@ -224,8 +224,28 @@[m [mexport class AppInitializer {[m
     _updateHtml(html) {[m
         if (!this.socketService || !this.socketService.isAuthorized()) return;[m
         [m
[32m+[m[32m        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è[m
[32m+[m[32m        const lastEditorSpan = document.getElementById('last-html-editor');[m
[32m+[m[32m        if (lastEditorSpan) {[m
[32m+[m[32m            lastEditorSpan.textContent = '(–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...)';[m
[32m+[m[32m            lastEditorSpan.classList.add('saving');[m
[32m+[m[32m        }[m
[32m+[m[41m        [m
[32m+[m[32m        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è[m
         this.socketService.updateHtml(html);[m
[32m+[m[41m        [m
[32m+[m[32m        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é[m
         this._updatePreview();[m
[32m+[m[41m        [m
[32m+[m[32m        // –ß–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è —É–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è[m
[32m+[m[32m        setTimeout(() => {[m
[32m+[m[32m            if (lastEditorSpan) {[m
[32m+[m[32m                lastEditorSpan.classList.remove('saving');[m
[32m+[m[32m                if (lastEditorSpan.textContent === '(–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...)') {[m
[32m+[m[32m                    lastEditorSpan.textContent = '';[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }, 1500);[m
     }[m
     [m
     /**[m
[36m@@ -236,8 +256,28 @@[m [mexport class AppInitializer {[m
     _updateCss(css) {[m
         if (!this.socketService || !this.socketService.isAuthorized()) return;[m
         [m
[32m+[m[32m        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è[m
[32m+[m[32m        const lastEditorSpan = document.getElementById('last-css-editor');[m
[32m+[m[32m        if (lastEditorSpan) {[m
[32m+[m[32m            lastEditorSpan.textContent = '(–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...)';[m
[32m+[m[32m            lastEditorSpan.classList.add('saving');[m
[32m+[m[32m        }[m
[32m+[m[41m        [m
[32m+[m[32m        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è[m
         this.socketService.updateCss(css);[m
[32m+[m[41m        [m
[32m+[m[32m        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é[m
         this._updatePreview();[m
[32m+[m[41m        [m
[32m+[m[32m        // –ß–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è —É–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è[m
[32m+[m[32m        setTimeout(() => {[m
[32m+[m[32m            if (lastEditorSpan) {[m
[32m+[m[32m                lastEditorSpan.classList.remove('saving');[m
[32m+[m[32m                if (lastEditorSpan.textContent === '(–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...)') {[m
[32m+[m[32m                    lastEditorSpan.textContent = '';[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }, 1500);[m
     }[m
     [m
     /**[m
[1mdiff --git a/js/socket-service.js b/js/socket-service.js[m
[1mindex 6fd48f5..3b04d02 100644[m
[1m--- a/js/socket-service.js[m
[1m+++ b/js/socket-service.js[m
[36m@@ -1,7 +1,16 @@[m
 // socket-service.js[m
 // –ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Socket.io[m
 [m
[31m-import { debounce, safeJSONParse } from './utils.js';[m
[32m+[m[32mimport {[m[41m [m
[32m+[m[32m    throttle,[m[41m [m
[32m+[m[32m    debounce,[m[41m [m
[32m+[m[32m    showNotification,[m[41m [m
[32m+[m[32m    saveToLocalBackup,[m[41m [m
[32m+[m[32m    restoreFromLocalBackup,[m[41m [m
[32m+[m[32m    retryOperation,[m
[32m+[m[32m    ensureSave,[m
[32m+[m[32m    safeJSONParse[m
[32m+[m[32m} from './utils.js';[m
 [m
 /**[m
  * –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è[m
[36m@@ -164,7 +173,7 @@[m [mexport class SocketService {[m
         this.editingCssTimer = null;[m
         this.lastEditedHtml = '';[m
         this.lastEditedCss = '';[m
[31m-        this.delayUpdateTime = 5000; // 5 —Å–µ–∫—É–Ω–¥[m
[32m+[m[32m        this.delayUpdateTime = 2000; // 2 —Å–µ–∫—É–Ω–¥—ã[m
         [m
         // –§–ª–∞–≥–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞[m
         this.isHtmlSelectionActive = false;[m
[36m@@ -175,8 +184,10 @@[m [mexport class SocketService {[m
         this.isProgrammaticallyUpdatingCss = false;[m
         [m
         // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç –¥—Ä—É–≥–∏—Ö –∫–æ–º–∞–Ω–¥ –≤–æ –≤—Ä–µ–º—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è[m
[31m-        this.pendingHtmlUpdates = {};[m
[31m-        this.pendingCssUpdates = {};[m
[32m+[m[32m        this.pendingHtmlUpdates = []; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∞—Å—Å–∏–≤[m
[32m+[m[32m        this.pendingCssUpdates = []; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∞—Å—Å–∏–≤[m
[32m+[m[32m        this.bufferStartSyncedHtml = ''; // –°–æ—Å—Ç–æ—è–Ω–∏–µ HTML –Ω–∞ –Ω–∞—á–∞–ª–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è[m
[32m+[m[32m        this.bufferStartSyncedCss = ''; // –°–æ—Å—Ç–æ—è–Ω–∏–µ CSS –Ω–∞ –Ω–∞—á–∞–ª–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è[m
         [m
         // –ë–∞—Ç—á–∏–Ω–≥ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫—É—Ä—Å–æ—Ä–∞ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞[m
         this.pendingCursorUpdate = null;[m
[36m@@ -206,6 +217,9 @@[m [mexport class SocketService {[m
                 return;[m
             }[m
             [m
[32m+[m[32m            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π beforeunload[m
[32m+[m[32m            this._setupBeforeUnloadHandler();[m
[32m+[m[41m            [m
             // –ò—Å–ø–æ–ª—å–∑—É–µ–º window.location.origin –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è URL[m
             this.socket = io(window.location.origin);[m
             [m
[36m@@ -222,6 +236,49 @@[m [mexport class SocketService {[m
         }[m
     }[m
     [m
[32m+[m[32m    /**[m
[32m+[m[32m     * –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã[m
[32m+[m[32m     * @private[m
[32m+[m[32m     */[m
[32m+[m[32m    _setupBeforeUnloadHandler() {[m
[32m+[m[32m        window.addEventListener('beforeunload', (event) => {[m
[32m+[m[32m            // –ï—Å–ª–∏ –º—ã —Å–µ–π—á–∞—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º HTML –∏–ª–∏ CSS, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è[m
[32m+[m[32m            if (this.isEditingHtml && this.lastEditedHtml) {[m
[32m+[m[32m                saveToLocalBackup('html', this.lastEditedHtml, this.teamName);[m
[32m+[m[41m                [m
[32m+[m[32m                // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏[m
[32m+[m[32m                const pendingSyncs = safeJSONParse(localStorage.getItem('pendingSyncs') || '[]', []);[m
[32m+[m[32m                pendingSyncs.push({[m
[32m+[m[32m                    type: 'html',[m
[32m+[m[32m                    teamName: this.teamName,[m
[32m+[m[32m                    timestamp: Date.now()[m
[32m+[m[32m                });[m
[32m+[m[32m                localStorage.setItem('pendingSyncs', JSON.stringify(pendingSyncs));[m
[32m+[m[32m            }[m
[32m+[m[41m            [m
[32m+[m[32m            if (this.isEditingCss && this.lastEditedCss) {[m
[32m+[m[32m                saveToLocalBackup('css', this.lastEditedCss, this.teamName);[m
[32m+[m[41m                [m
[32m+[m[32m                // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏[m
[32m+[m[32m                const pendingSyncs = safeJSONParse(localStorage.getItem('pendingSyncs') || '[]', []);[m
[32m+[m[32m                pendingSyncs.push({[m
[32m+[m[32m                    type: 'css',[m
[32m+[m[32m                    teamName: this.teamName,[m
[32m+[m[32m                    timestamp: Date.now()[m
[32m+[m[32m                });[m
[32m+[m[32m                localStorage.setItem('pendingSyncs', JSON.stringify(pendingSyncs));[m
[32m+[m[32m            }[m
[32m+[m[41m            [m
[32m+[m[32m            // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è[m
[32m+[m[32m            if (this.isEditingHtml || this.isEditingCss) {[m
[32m+[m[32m                // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π[m
[32m+[m[32m                const message = '–ï—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –û–Ω–∏ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ.';[m
[32m+[m[32m                event.returnValue = message;[m
[32m+[m[32m                return message;[m
[32m+[m[32m            }[m
[32m+[m[32m        });[m
[32m+[m[32m    }[m
[32m+[m[41m    [m
     /**[m
      * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π —Å–æ–∫–µ—Ç–∞[m
      * @private[m
[36m@@ -231,16 +288,22 @@[m [mexport class SocketService {[m
 [m
         // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞[m
         this.socket.on('auth_success', (data) => {[m
[32m+[m[32m            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è –∫–æ–º–∞–Ω–¥—ã –∏ –¥–∞–Ω–Ω—ã–µ[m
             this.teamName = data.teamName;[m
[31m-            this.teamData = data.teamData;[m
[32m+[m[32m            this.teamData = data.teamData || null;[m
[32m+[m[41m            [m
[32m+[m[32m            // –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤[m
[32m+[m[32m            for (const listener of this.authListeners) {[m
[32m+[m[32m                listener(data);[m
[32m+[m[32m            }[m
[32m+[m[41m            [m
[32m+[m[32m            // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—ã—Ç–∞–µ–º—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è[m
[32m+[m[32m            setTimeout(() => this._syncLocalBackups(), 1000);[m
       [m
       // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage[m
             localStorage.setItem('teamName', this.teamName);[m
             localStorage.setItem('teamData', JSON.stringify(this.teamData));[m
             [m
[31m-            // –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –æ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏[m
[31m-            this.authListeners.forEach(listener => listener(data));[m
[31m-            [m
             // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∫–æ–¥–∞[m
             this.socket.emit('initialize_code');[m
         });[m
[36m@@ -395,11 +458,12 @@[m [mexport class SocketService {[m
      * @param {string} html - –ù–æ–≤—ã–π HTML –∫–æ–¥[m
      */[m
     updateHtml(html) {[m
[31m-        // –ï—Å–ª–∏ –º—ã —É–∂–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º, —Ç–æ —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–º–µ–Ω–∏–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä —Å–±—Ä–æ—Å–∞ —Ñ–ª–∞–≥–∞[m
[32m+[m[32m        // –°–Ω–∞—á–∞–ª–∞ –≤—Å–µ–≥–¥–∞ –¥–µ–ª–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é[m
[32m+[m[32m        saveToLocalBackup('html', html, this.teamName);[m
[32m+[m[41m        [m
         if (this.editingHtmlTimer) {[m
             clearTimeout(this.editingHtmlTimer);[m
[31m-            // –ï—Å–ª–∏ —É –Ω–∞—Å —É–∂–µ –±—ã–ª —Ç–∞–π–º–µ—Ä, –∑–Ω–∞—á–∏—Ç –º—ã –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ[m
[31m-            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π[m
[32m+[m[32m            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ[m
             this._socketEmit('update_html', { [m
                 html, [m
                 teamName: this.teamName,[m
[36m@@ -407,11 +471,14 @@[m [mexport class SocketService {[m
                 isContinuousEdit: true[m
             });[m
         } else {[m
[31m-            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è[m
[32m+[m[32m            // –ù–∞—á–∏–Ω–∞–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ[m
             this.isEditingHtml = true;[m
[31m-            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤–µ—Ä—Å–∏—é[m
             this.localHtmlVersion++;[m
[31m-            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ù–ï–ú–ï–î–õ–ï–ù–ù–û[m
[32m+[m[32m            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –Ω–∞—á–∞–ª–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ª–∏—è–Ω–∏—è[m
[32m+[m[32m            this.bufferStartSyncedHtml = this.lastSyncedHtml;[m
[32m+[m[32m            // –û—á–∏—â–∞–µ–º –±—É—Ñ–µ—Ä –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –æ–Ω –Ω–µ –±—ã–ª –æ—á–∏—â–µ–Ω —Ä–∞–Ω–µ–µ[m
[32m+[m[32m            this.pendingHtmlUpdates = [];[m
[32m+[m[32m            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ[m
             this._socketEmit('update_html', { [m
                 html, [m
                 teamName: this.teamName,[m
[36m@@ -419,24 +486,38 @@[m [mexport class SocketService {[m
             });[m
         }[m
         [m
[31m-        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è[m
         this.lastEditedHtml = html;[m
         [m
[31m-        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä –Ω–∞ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è[m
         this.editingHtmlTimer = setTimeout(() => {[m
             log(`–°–Ω—è—Ç —Ñ–ª–∞–≥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è HTML, –ø—Ä–æ—à–ª–æ ${this.delayUpdateTime}ms`);[m
[32m+[m[32m            const finalLocalHtml = this.lastEditedHtml; // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ[m
             this.isEditingHtml = false;[m
             this.editingHtmlTimer = null;[m
[32m+[m[32m            this.lastSyncedHtml = finalLocalHtml; // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º, —Ç.–∫. —ç—Ç–æ –Ω–∞—à–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è[m
             [m
[31m-            // –ü—Ä–∏ —Å–Ω—è—Ç–∏–∏ —Ñ–ª–∞–≥–∞ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é[m
[31m-            this.lastSyncedHtml = html;[m
[31m-            [m
[31m-            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ[m
[31m-            this._socketEmit('update_html', { [m
[31m-                html, [m
[32m+[m[32m            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –¥–æ—Å—Ç–∞–≤–∫–∏[m
[32m+[m[32m            const finalData = {[m
[32m+[m[32m                html: finalLocalHtml,[m[41m [m
                 teamName: this.teamName,[m
                 version: this.localHtmlVersion,[m
                 isFinalEdit: true[m
[32m+[m[32m            };[m
[32m+[m[41m            [m
[32m+[m[32m            retryOperation([m
[32m+[m[32m                () => {[m
[32m+[m[32m                    const result = this._socketEmit('update_html', finalData);[m
[32m+[m[32m                    if (!result) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ HTML');[m
[32m+[m[32m                    return result;[m
[32m+[m[32m                },[m
[32m+[m[32m                3, 1000[m
[32m+[m[32m            ).then(() => {[m
[32m+[m[32m                // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è[m
[32m+[m[32m                this._applyBufferedUpdates('html');[m
[32m+[m[32m            }).catch(error => {[m
[32m+[m[32m                log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ HTML: ${error.message}`, 'error');[m
[32m+[m[32m                // –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–æ–±—É–µ–º –ø—Ä–∏–º–µ–Ω–∏—Ç—å –±—É—Ñ–µ—Ä,[m
[32m+[m[32m                // —Ç.–∫. –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏ –±—É–¥—É—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–∑–∂–µ.[m
[32m+[m[